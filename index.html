<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>View non-printable unicode characters</title>
    <style>
      body {
        font-family: Helvetica, Arial, sans-serif;
        background-color: #eeeeee;
      }
      div.main {
        background-color: white;
        border-radius: 10px;
        border: 2px solid #666666;
        box-shadow: 5px 5px 5px #999999;
        padding: 2.4em 3em;
        margin: 0 auto;
        max-width: 1000px;
      }
      div.output {
        margin: 3em 0;
        border: 1px solid #666666;
        padding: 0.4em 0.2em;
        font-family: Courier New, Courier, monospaced;
        cursor: default;
      }
      div.output span.symbol {
        color: white;
        background-color: #999999;
        padding: 0 2px;
        margin: 0 2px;
      }
      div.output span.hex {
        color: black;
        background-color: #9999ff;
        padding: 0 2px;
        margin: 0 2px;
      }
      span.S2Tooltip.anchor {
        white-space: nowrap;
      }
      span.S2Tooltip.container {
        position: absolute;
        z-index: 999;
        left: -99999px;
        top: -99999px;
      }
      span.S2Tooltip.anchor:hover {
        background-color: #ff9999;
      }
      span.S2Tooltip.anchor:hover + span.S2Tooltip.container {
        left: auto;
        top: auto;
      }
      span.S2Tooltip.tiptext {
        position: absolute;
        left: -2em;
        top: 1.5em;
        padding: 0.5em 0.8em 0.7em 0.8em;
        color: black;
        background-color: #ddddff;
        border: 1px solid #9999ff;
        font-weight: normal;
        text-align: left;
        display: block;
        text-indent: 0;
      }
    </style>
  </head>
  <body>
    <div class="main">
      <h1>View non-printable unicode characters</h1>
      <p>
        Online tool to display non-printable characters that may be hidden in
        copy&amp;pasted strings.
      </p>

      <form action="" method="POST" accept-charset="UTF-8">
        <div style="margin-top: 3em">Please paste the string here:</div>
        <div>
          <textarea
            name="s"
            id="text-input"
            rows="8"
            cols="40"
            style="width: 100%; box-sizing: border-box"
            dir="auto"
          ></textarea>
        </div>
        <div>
          <button type="submit" id="submit-button">
            Show me the characters
          </button>
        </div>
      </form>
      <div id="output-container"></div>
      <div id="info-container" style="margin: -2.5em 0 4em 0"></div>

      <h2>Helpful Sites for Details on UTF Characters</h2>
      <ul>
        <li>
          <a href="https://www.branah.com/unicode-converter" target="_blank"
            >Branah.com Unicode Converter</a
          >
        </li>
        <li>
          <a
            href="http://www.fileformat.info/info/unicode/char/search.htm"
            target="_blank"
            >FileFormat.Info</a
          >
        </li>
        <li>
          <a
            href="http://utf8-chartable.de/unicode-utf8-table.pl"
            target="_blank"
            >utf8-chartable.de</a
          >
        </li>
      </ul>

      <h2>Privacy Note</h2>
      <p>
        This web page (tool) does not store any information about you (no
        cookies, no IP logging) and it does not store any of the text that is
        written or pasted into the box above.
      </p>
      <h2>Source Code</h2>
      <p>This tool is open source and available on <a href="https://github.com/BurninLeo/see-non-printable-characters">GitHub</a>.</p>
    </div>
    <script>
      class ViewChars {
        static htmlChar(c) {
          const n = c.codePointAt(0);
          let desc;
          let hex;

          if (n < 0x10000) {
            desc = `&amp;#${n};<br>\\u${n
              .toString(16)
              .toUpperCase()
              .padStart(4, "0")}`;
            hex = `U+${n.toString(16).toUpperCase().padStart(4, "0")}`;
          } else {
            desc = `&amp;#${n};<br>\\u{${n.toString(16).toUpperCase()}}`;
            hex = `U+${n.toString(16).toUpperCase()}`;
          }

          let symbol;
          if (c === "\r") {
            symbol = '<span class="symbol S2Tooltip anchor">CR</span>';
          } else if (c === "\n") {
            symbol = '<span class="symbol S2Tooltip anchor">LF</span>';
          } else if (c === "\t") {
            symbol = '<span class="symbol S2Tooltip anchor">⟶</span>&#8203;';
          } else if (c === " ") {
            symbol = '<span class="white S2Tooltip anchor">·</span>&#8203;';
          } else {
            if (/^[\p{L}\p{M}\p{N}\p{P}\p{S}]$/u.test(c)) {
              symbol = `<span class="S2Tooltip anchor">${c}</span>`;
            } else {
              symbol = `<span class="hex S2Tooltip anchor">${hex}</span>`;
            }
          }

          return `
            ${symbol}
            <span class="S2Tooltip container">
                <span class="S2Tooltip tiptext rounded shadow">${desc}</span>
            </span>`;
        }

        static text2html(s) {
          let html = '<div class="output" dir="auto">';
          let nlc = 0; // Newline controller

          for (const c of s) {
            if (c === "\r") {
              if (nlc === 0) {
                nlc = 1; // CR seen
                html += this.htmlChar(c);
              } else if (nlc === 1) {
                // CR after CR
                html += "<br>" + this.htmlChar(c);
                nlc = 1;
              } else if (nlc === 2) {
                // CR after LF
                html += this.htmlChar(c) + "<br>";
                nlc = 0;
              }
            } else if (c === "\n") {
              if (nlc === 0) {
                nlc = 2; // LF seen
                html += this.htmlChar(c);
              } else if (nlc === 2) {
                // LF after LF
                html += "<br>" + this.htmlChar(c);
                nlc = 2;
              } else if (nlc === 1) {
                // LF after CR (CRLF)
                html += this.htmlChar(c) + "<br>";
                nlc = 0;
              }
            } else {
              if (nlc !== 0) {
                html += "<br>";
                nlc = 0;
              }
              html += this.htmlChar(c);
            }
          }

          return html + "</div>";
        }

        static processText() {
          const textInput = document.getElementById("text-input");
          const outputContainer = document.getElementById("output-container");
          const infoContainer = document.getElementById("info-container");

          const s = textInput.value;

          outputContainer.innerHTML = this.text2html(s);

          const charCount = s.length;
          const byteCount = new TextEncoder().encode(s).length;
          infoContainer.innerHTML = `${charCount} characters, ${byteCount} bytes`;
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const textInput = document.getElementById("text-input");
        const form = document.querySelector("form");

        textInput.value =
          "See\u00A0what's hidden in your string\u2026\tor be\u200Bhind\uFEFF";
        ViewChars.processText();

        form.addEventListener("submit", (e) => {
          e.preventDefault();
          ViewChars.processText();
        });
      });
    </script>
  </body>
</html>
